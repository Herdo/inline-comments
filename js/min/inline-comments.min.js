!function(n,$){"use strict";var t,i="incom_wrapper",e="#"+i,o="html",a="comments-and-form",r="#"+a,c="incom-commentform",u="data-incom",s=u+"-comment",l=[],f=u+"-bubble",d=u+"-ref",m="incom-active",v="."+m,h="incom-visible-comment",p="."+h,b="incom-position-",g="incom-bubble",y="."+g,w=g+"-style",k=g+"-static",S="."+k,C=g+"-dynamic",A=g+"-active",T=g+"-link",x="incom-comments-wrapper",I="."+x,O="incom-reply",B="."+O,W="incom-cancel",_="."+W,j="incom-info-icon",q="."+j,D="incom-scrolled-to",E=r+" .comment",F="data_incom",H=0,N=$(window).width(),K,Q,X;n.init=function(n){Y(n),z(),G(),jn(),In(),$(B+" .comment-reply-link").on("click",function(){$(r+" #commentform").attr("id",c)}),Bn.init()},n.rebuild=function(){N=$(window).width(),l=[],$("#incom_wrapper .incom-bubble").remove(),G();var n=$(r+":visible");n.length&&(kn(),Sn("out"))};var Y=function(n){t=$.extend({selectors:"p",moveSiteSelector:o,countStatic:!0,alwaysStatic:!1,defaultBubbleText:"+",bubbleStyle:"bubble",bubbleAnimationIn:"default",bubbleAnimationOut:"default",position:"left",background:"white",backgroundOpacity:"1",displayBranding:!1},n)},z=function(){0===$(e).length&&$('<div id="'+i+'"></div>').appendTo($(o)).addClass(b+t.position)},G=function(){$(t.selectors).each(function(){var n=$(this);J(n),L.createFromElement(n)})},J=function(n,t){if(t=t||0,!n.attr(u)){var i=M(n);t=P(t,i);var e=i+t;n.attr(u,e)}},L={set:function(n){var t=$.extend({posX:void 0,posY:void 0,id:void 0,visible:!1},n)},createFromElement:function(n){R(n)}},M=function(n){var t=n.prop("tagName").substr(0,5);return t},P=function(n,t){var i=t+n;if(-1!==$.inArray(i,l))for(;-1!==$.inArray(i,l);)n++,i=t+n;return l.push(i),n},R=function(n){var t=U(n),i=Z(n),o=$("<a/>",{href:"","class":T}).text(t).wrap(i).parent().appendTo(e);en(o),mn(n,o),hn(o)?(on(n,o),an(n,o)):o.hide()},U=function(n){var i;return i=tn(n)?V(n):t.defaultBubbleText},V=function(n){var t=n.attr(u),i="["+s+"="+t+"]",e=$(i).length;return e+=$(i+" .children li").length},Z=function(n){var t=n.attr(u),i='<div class="'+nn(n)+'" '+f+'="'+t+'" />';return i},nn=function(n){var i=g,e=" ";return(t.alwaysStatic||tn(n)&&t.countStatic)&&(i+=e+k),i+=tn(n)||!tn(n)&&"bubble"===t.bubbleStyle?e+w:e+C},tn=function(n){var t=V(n);return $.isNumeric(t)&&t>0?!0:!1},en=function(n){n.hasClass(k)&&n.css("display","block")},on=function(n,i){i.hasClass(k)||n.add(i).hover(function(){$(y+":not("+S+")").hide(),"fadein"===t.bubbleAnimationIn?i.stop(!0,!0).fadeIn():i.stop(!0,!0).show(),hn(i)||i.hide()},function(){"fadeout"===t.bubbleAnimationOut?i.stop(!0,!0).fadeOut():i.stop(!0,!0).delay(700).hide(0)})},an=function(n,t){t.on("click",function(i){i.preventDefault();var e=$(this);e.hasClass(A)?(kn(!0),e.removeClass(A)):(_n(m),n.addClass(m),kn(),t.addClass(A),cn(t))})},rn=function(){var n;return n=0===$(I).length?$("<div/>",{"class":x}).appendTo(e).css("background-color","rgba("+Dn(t.background)+","+t.backgroundOpacity+")"):$(I)},cn=function(n){var t=rn();fn(),sn(),mn(n,t),pn(t),yn(),un()},un=function(){$(document).ready(wn()).ajaxStop(function(){wn()})},sn=function(){$(r).appendTo(I).show(),ln()},ln=function(){var n=$("<input>").attr("type","hidden").attr("name",F).val(dn);$(r+" .form-submit").append($(n))},fn=function(){var n="["+s+"="+dn()+"]";$(E).hide(),$(E+n).addClass(h).show(),$(p+" .children li").show()},dn=function(){var n=$(v).attr(u);return n},mn=function(n,t){var i=n.offset();t.css({top:i.top,left:xn()?i.left+n.outerWidth():i.left-t.outerWidth()})},vn=function(n){K=n.outerWidth(),Q=n.offset().left,X=Q+K},hn=function(n){return vn(n),X>N||0>Q?!1:!0},pn=function(n){vn(n),xn()&&X>N?(bn(X-N),Sn("in")):!xn()&&0>Q&&(bn(-Q),Sn("in"))},bn=function(n){H=n},gn=function(){return H},yn=function(){$("html").click(function(n){0===$(n.target).parents(e).length&&kn(!0)})},wn=function(){$(_).click(function(n){n.preventDefault(),kn(!0)})},kn=function(n){var t=$(y),i=$(I);$(r).appendTo(e).hide(),$(p).removeClass(h),t.hasClass(A)&&(t.removeClass(A),n?i.fadeOut("fast",function(){$(this).remove(),_n(m)}):i.remove(),Sn("out"))},Sn=function(n){var i=$(t.moveSiteSelector);i.css({position:"relative"}),Cn(i,n),t.moveSiteSelector!==o&&(Tn(n,y),Tn(n,I))},Cn=function(n,t){var i;"in"===t?i=gn():"out"===t&&(i="initial"),An(n,i)},An=function(n,t){var i=xn()?"right":"left",e={};e[i]=t,n.css(e)},Tn=function(n,t){var i=$(t);"in"===n?i.css({left:xn()?"-="+gn():"+="+gn()}):"out"===n&&i.css({left:xn()?"+="+gn():"-="+gn()})},xn=function(){return"right"===t.position?!0:!1},In=function(){var n=d,t=u;On(n,t),Wn(n,t)},On=function(n,t){$("["+n+"]").each(function(){var i=$(this),e=i.attr(n),o=$("["+t+'="'+e+'"]');o.length||i.parent().remove()})},Bn={init:function(){this.permalinksHandler()},permalinksHandler:function(){$(r).on("click","a.incom-permalink",function(){var n=$(this.hash);if(n.length){Hn(n);var t=$(this).attr("href");return Fn(t),!1}})}},Wn=function(n,t){$("["+n+"]").click(function(){var i=$(this).attr(n),e=$("["+t+'="'+i+'"]');e.length&&(Hn(e),_n(D),e.addClass(D))})},_n=function(n){var t=$("."+n);0!==t.length&&(t.removeClass(n),0===t.prop("class").length&&t.removeAttr("class"))},jn=function(){var n=$(".incom-cancel-x"),i=$(qn());t.displayBranding!==!0&&1!==t.displayBranding||$(q).length||n.after(i)},qn=function(){return'<a class="'+j+'" href="http://kevinw.de/inline-comments/" title="Inline Comments by Kevin Weber" target="_blank">i</a>'},Dn=function(n){var t=parseInt(En(n).substring(0,2),16),i=parseInt(En(n).substring(2,4),16),e=parseInt(En(n).substring(4,6),16);return t+","+i+","+e},En=function(n){return"#"===n.charAt(0)?n.substring(1,7):n};$.easing.quart=function(n,t,i,e,o){return-e*((t=t/o-1)*t*t*t-1)+i};var Fn=function(n){history.pushState(null,null,n),history.pushState?history.pushState(null,null,n):location.hash=n},Hn=function(n){var t=$("html, body"),i=n.offset().top-30;t.animate({scrollTop:i},1200,"quart")}}(window.incom=window.incom||{},jQuery);